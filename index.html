<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>每周关注</title>
    <link id="css" rel="stylesheet" href="css/jquery.mobile-1.4.2.css">
    <script src="js/jquery.js"></script>
    <script src="js/jquery.mobile-1.4.2.js"></script>
    <script>
    	function callback(){getlist(json);}
    	function getlist(json){
    		if(json==undefined){
    			json=JSON.parse(localStorage.getItem("news"));
    			if(json==null){
    				query();
    			}else{
    				getlist(json);
    			}
    			
    		}else{
    			document.getElementById("news20").innerHTML='';
    			for(var i in json){
    				;
	    			var li=document.createElement("li");
	    			var a=document.createElement("a");
	    			a.title=json[i].bza;
	    			a.innerHTML=json[i].title;
	    			a.dataTransition="flip";
	    			a.href="#news";
	    			a.index=i;
	    			a.className="ui-btn ui-btn-icon-right ui-icon-carat-r";
	    			a.onclick=function(){
	    				document.getElementById("title").innerHTML=json[this.index].title;
	    				document.getElementById("bza").innerHTML=json[this.index].bza;
	    				document.getElementById("text").innerHTML=json[this.index].text;
	    				document.getElementById("xj").innerHTML=json[this.index].xj;
	    				//document.getElementById("news20").style.display="none";
	    				//document.getElementById("page").style.display="block";
	    				//document.getElementById("return").style.display="block";
	    				//document.getElementById("get").style.display="none";
	    			}
	    			li.appendChild(a);
	    			document.getElementById("news20").appendChild(li);
	    		}
    			$("#get").text('刷新');
    			localStorage.setItem("news", JSON.stringify(json));
    		}
    	}
    	function query(){
    		$("#get").text("新闻获取中。。。");
    		var s=document.createElement("script");
    		s.src="http://121.197.3.58/2014_week/json.php?callback="+callback;
    		document.getElementById("jsbox").innerHTML="";
    		document.getElementById("jsbox").appendChild(s);
    	}
    	function returnindex(){
    		json=JSON.parse(localStorage.getItem("news"));
    		getlist(json);
    	}
    	function init(){
    		$("#mypanel").trigger("updatelayout");
    		getlist();
    		setInterval(function(){
				query();
			},1000*60);
    	}
    	window.onload=init;
    </script>
<body>
<div id="jsbox"></div>
<div data-role="page" id="index">
  <div data-role="header">
    <a href="#" data-role="button" data-icon="home">首页</a>
    <h1>每周关注</h1>
    <a href="#mypanel" data-role="button" data-icon="info">关于</a>
  </div>
  <div data-role="content">
  	<a id="get" onclick="query();" data-role="button" data-icon="refresh">刷新</a>
    <ol id="news20" data-role="listview" data-inset="true"></ol>
  </div>
  <div data-role="panel" id="mypanel">
			<p>每周关注</p>
			<p>www.lcvlcv.com</p>
			<p>内容皆由村官与自愿者推荐,如有侵权,请联系我们,我们立刻删除.</p>
			<p>联系电话:010-66115942</p>
			<a href="#" data-rel="close">关闭</a>
		    <!-- panel content goes here -->
  </div><!-- /panel -->
  <div data-role="footer">
    <h1>每周关注v1.01 技术支持:g@codetyphon.com</h1>
  </div>
</div>	

  <div data-role="page" id="news">
  	<div data-role="header">
	    <a href="#index" data-role="button" data-icon="home">返回首页</a>
	    <h1>每周关注</h1>
	    <a href="#mypanel" data-role="button" data-icon="info">关于</a>
	  </div>
  	<div data-role="content">
	  			<div id="return" data-role="button" data-icon="home" style="display: none;" onclick='document.getElementById("news20").style.display="block";document.getElementById("page").style.display="none";document.getElementById("return").style.display="none";document.getElementById("get").style.display="block";'>返回</div>
				<h2 id="title"></h2>
				<p id="bza"></p>
				<p id="text"></p>
				<p id="xj"></p>
	</div>
	<div data-role="footer">
	    <h1>每周关注v1.01 技术支持:g@codetyphon.com</h1>
	</div>
</body>
</html>
